pipeline {
    agent any
    environment {
        PATH = "C:\\Windows\\System32;C:\\Windows;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;C:\\Program Files\\Python313\\;C:\\Program Files\\Python313\\Scripts\\"
    }
    stages {
        stage('Check Git & Docker') {
            steps {
                bat '"C:\\Program Files\\Git\\cmd\\git.exe" --version'
                bat '"C:\\Program Files\\Docker\\Docker\\resources\\bin\\docker.exe" --version'
                bat 'echo %PATH%'
            }
        }
        stage('Checkout') {
            steps {
                echo '[INFO] Checking out code from Git...'
                checkout([$class: 'GitSCM', branches: [[name: '*/main']],
                          userRemoteConfigs: [[url: 'https://github.com/zineb-chgari/traffic_optimizer.git']]])
                // Afficher le dernier commit
                bat '"C:\\Program Files\\Git\\cmd\\git.exe" log -1 --pretty=oneline'
            }
        }
        stage('Install Dependencies') {
            steps {
                echo '[INFO] Installing dependencies...'
                // bat 'pip install -r requirements.txt' // DÃ©commenter si Python
            }
        }
    }
    post {
        always {
            echo '[INFO] Cleaning up Docker...'
            bat '"C:\\Program Files\\Docker\\Docker\\resources\\bin\\docker.exe" system prune -f || exit 0'
        }
        failure {
            echo '[ERROR] Pipeline failed'
        }
    }
}
